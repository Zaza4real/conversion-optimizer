# Railway config for Conversion Optimizer backend (apps/backend)
# If Railway doesn't use this automatically, set Root Directory to "apps/backend" in the dashboard.

[build]
builder = "nixpacks"
buildCommand = "npm install && npm run build"

[deploy]
startCommand = "npm run start"
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 10
# Run DB migration (recommendations index) before each deploy. Uses DATABASE_URL from Railway.
preDeployCommand = "node run-recommendations-index-migration.js"
